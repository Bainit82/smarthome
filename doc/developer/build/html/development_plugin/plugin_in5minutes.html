

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>How to write a Plugin in 5 min. &mdash; Developer Documentation 1.3c develop (as of 31. October 2017, commit 34c17bf) documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Developer Documentation 1.3c develop (as of 31. October 2017, commit 34c17bf) documentation" href="../index.html"/>
        <link rel="up" title="Development of Plugins" href="../development_plugins.html"/>
        <link rel="next" title="Class SmartPlugin" href="smartplugin.html"/>
        <link rel="prev" title="Plugin development guidelines" href="../dev/README.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Developer Documentation
          

          
            
            <img src="../_static/logo_long_inverse3.png" class="logo" />
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
    
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../user_doc.html">User Documentation (German)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../requirements.html">Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../config.html">Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../config.html#structure-of-smarthomeng">Structure of SmartHomeNG</a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#config-files-in-directory-etc">Config files in directory <strong>etc</strong></a><ul>
<li class="toctree-l3"><a class="reference internal" href="../config.html#smarthome-yaml">smarthome.yaml</a></li>
<li class="toctree-l3"><a class="reference internal" href="../config.html#plugin-yaml">plugin.yaml</a></li>
<li class="toctree-l3"><a class="reference internal" href="../config.html#logic-yaml">logic.yaml</a></li>
<li class="toctree-l3"><a class="reference internal" href="../config.html#logging-yaml">logging.yaml</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#item-definitions-in-directory-items">Item definitions in directory <strong>items</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#logic-definitions-in-directory-logics">Logic definitions in directory <strong>logics</strong></a></li>
<li class="toctree-l2"><a class="reference internal" href="../config.html#smarthomeng-start-options">SmartHomeNG start options</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../items.html">Items</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../items.html#overview">Overview</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../items.html#item-attributes">Item Attributes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../items.html#item-functions">Item functions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../items.html#example-logic-with-uses-of-above-functions">Example logic with uses of above functions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../logics.html">Logics</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../logics.html#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../logics.html#configuration-parameters">Configuration parameters</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../logics.html#watch-item">watch_item</a></li>
<li class="toctree-l3"><a class="reference internal" href="../logics.html#cycle">cycle</a></li>
<li class="toctree-l3"><a class="reference internal" href="../logics.html#crontab">crontab</a></li>
<li class="toctree-l3"><a class="reference internal" href="../logics.html#enabled">enabled</a></li>
<li class="toctree-l3"><a class="reference internal" href="../logics.html#prio">prio</a></li>
<li class="toctree-l3"><a class="reference internal" href="../logics.html#other-parameters">Other parameters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../logics.html#basic-structure-of-a-logic-script">Basic Structure of a logic script</a></li>
<li class="toctree-l2"><a class="reference internal" href="../logics.html#loaded-python-modules">Loaded Python modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../logics.html#available-objects-methods">Available Objects/Methods</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../logics.html#logic">logic</a></li>
<li class="toctree-l3"><a class="reference internal" href="../logics.html#logic-trigger">logic.trigger()</a></li>
<li class="toctree-l3"><a class="reference internal" href="../logics.html#trigger">trigger</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../logics.html#logger-and-sh-log">logger and sh.log</a></li>
<li class="toctree-l2"><a class="reference internal" href="../logics.html#smarthomeng-methods-to-use">SmartHomeNG methods to use</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../logics.html#sh-now-and-sh-utcnow">sh.now and sh.utcnow</a></li>
<li class="toctree-l3"><a class="reference internal" href="../logics.html#sh-sun">sh.sun</a></li>
<li class="toctree-l3"><a class="reference internal" href="../logics.html#sh-moon">sh.moon</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../logics.html#scheduling">Scheduling</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../logics.html#sh-scheduler-trigger-sh-trigger">sh.scheduler.trigger() / sh.trigger()</a></li>
<li class="toctree-l3"><a class="reference internal" href="../logics.html#sh-scheduler-change">sh.scheduler.change()</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../logics.html#sh-tools-object">sh.tools object</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../logics.html#sh-tools-ping">sh.tools.ping()</a></li>
<li class="toctree-l3"><a class="reference internal" href="../logics.html#sh-tools-dewpoint">sh.tools.dewpoint()</a></li>
<li class="toctree-l3"><a class="reference internal" href="../logics.html#sh-tools-fetch-url">sh.tools.fetch_url()</a></li>
<li class="toctree-l3"><a class="reference internal" href="../logics.html#sh-tools-dt2ts-dt">sh.tools.dt2ts(dt)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../logics.html#sh-tools-dt2js-dt">sh.tools.dt2js(dt)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../logics.html#sh-tools-rel2abs-temp-hum">sh.tools.rel2abs(temp, hum)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../logics.html#accessing-items">Accessing items</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../logics.html#sh-return-item-path">sh.return_item(path)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../logics.html#sh-return-items">sh.return_items()</a></li>
<li class="toctree-l3"><a class="reference internal" href="../logics.html#sh-match-items-regex">sh.match_items(regex)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../logics.html#sh-find-items-configattribute">sh.find_items(configattribute)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../logics.html#find-children-parentitem-configattribute">find_children(parentitem, configattribute):</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../plugins_all.html">Plugins</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../plugins_doc/plugins_system.html">System Plugins</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plugins/backend/README.html">Backend GUI (beyond shNG v1.3)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/blockly/README.html">Blockly Logic Editor (beyond shNG v1.3)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/cli/README.html">CLI</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/database/README.html">Database</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/datalog/README.html">DataLog</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/influxdata/README.html">influxdata</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/influxdb/README.html">Influxdb</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/memlog/README.html">MemLog</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/operationlog/README.html">OperationLog</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/rrd/README.html">RRDTool</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/rtr/README.html">RTR plug-in</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/simulation/README.html">Simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/sqlite/README.html">SQLite (for SmartVisu &lt; 2.8)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/sqlite_visu2_8/README.html">SQLite (for SmartVisu &gt;= 2.8)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/uzsu/README.html">UZSU</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/visu_smartvisu/README.html">Visualisation (smartVISU support)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/visu_websocket/README.html">Visualisation (Websocket Protocol)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plugins_doc/plugins_gateway.html">Gateway Plugins</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plugins/artnet/README.html">Artnet</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/dashbutton/README.html">Amazon Dashbutton Plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/dmx/README.html">DMX</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/ecmd/README.html">ECMD</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/elro/README.html">Elro</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/enocean/README.html">EnOcean</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/hue/README.html">Phillips HUE</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/iaqstick/README.html">iAQ Stick</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/knx/README.html">KNX</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/lirc/README.html">lirc</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/milight/README.html">miLight</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/mlgw/README.html">Bang &amp; Olufsen Masterlink Gateway</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/mpd/README.html">MPD</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/onewire/README.html">Onewire</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/raumfeld/README.html">Raumfeld</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/rcswitch/README.html">RCswitch</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/smawb/README.html">SMA-WebBox (smawb)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/snom/README.html">snom</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/sonos/README.html">Sonos</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/squeezebox/README.html">Squeezebox</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/tellstick/README.html">Tellstick</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plugins_doc/plugins_interface.html">Interface Plugins</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plugins/apcups/README.html">APC UPS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/asterisk/README.html">Asterisk</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/avdevice/README.html">AV Device</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/avm/README.html">AVM</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/buderus/README.html">buderus</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/comfoair/README.html">ComfoAir</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/dlms/README.html">DLMS</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/drexelundweiss/README.html">Drexel &amp; Weiss</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/easymeter/README.html">Easymeter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/ebus/README.html">eBus</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/enigma2/README.html">Enigma2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/eta_pu/README.html">ETA Pellet Unit PU</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/gpio/README.html">GPIO</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/harmony/README.html">Harmony Hub Plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/helios/README.html">Helios ECx00Pro / Vallox xx SE Plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/homematic/README.html">homematic</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/intercom_2n/README.html">2N-Intercom Plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/kathrein/README.html">Kathrein</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/kostal/README.html">KOSTAL</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/logo/README.html">logo</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/luxtronic2/README.html">Luxtronic2</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/netio230b/README.html">NetIO230B</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/nuki/README.html">Nuki</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/nut/README.html">NUT - Network UPS Tools plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/plex/README.html">plex</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/pluggit/README.html">PLUGGIT</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/roomba/README.html">Roomba</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/russound/README.html">Russound</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/sma/README.html">SMA</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/sma_em/README.html">SMA-EM Plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/smarttv/README.html">SmartTV</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/sml/README.html">Sml</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/solarlog/README.html">Solarlog</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/systemair/README.html">Systemair</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/volkszaehler/README.html">Volkszaehler Plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/vr100/README.html">VR100</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/xbmc/README.html">XBMC</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/xiaomi/README.html">Xiaomi</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/yamaha/README.html">Yamaha</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plugins_doc/plugins_protocol.html">Protocol Plugins</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plugins/mqtt/README.html">MQTT</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/mqtt_1_0/README.html">MQTT 1.0</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/network/README.html">Network</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/wol/README.html">WakeOnLan</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/xmpp/README.html">XMPP</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plugins_doc/plugins_web.html">Web/Cloud Plugins</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plugins/alexa/README.html">Alexa</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/boxcar/README.html">Boxcar Notification Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/dwd/README.html">DWD</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/ical/README.html">iCal</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/join/README.html">Join</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/mail/README.html">Mail</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/mvg_live/README.html">MVG Live</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/nma/README.html">nma - Notify My Android</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/nokia_health/README.html">Nokia Health</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/odlinfo/README.html">ODLInfo</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/openenergymonitor/README.html">OpenEnergyMonitor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/prowl/README.html">Prowl</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/pushbullet/README.html">Pushbullet</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/speech/README.html">Speech Parser</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/tankerkoenig/README.html">TankerKoenig</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/telegram/README.html">Telegram</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/traffic/README.html">Traffic</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/webservices/README.html">WebServices plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/wettercom/README.html">wetter.com</a></li>
<li class="toctree-l3"><a class="reference internal" href="../plugins/wunderground/README.html">Wunderground</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plugins_doc/plugins_unclassified.html">Unclassified Plugins</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../plugins/pushover/README.html">Pushover</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../modules.html">Modules for use with plugins</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../modules/dummy/README.html">Module dummy</a></li>
<li class="toctree-l3"><a class="reference internal" href="../modules/http/README.html">Module http</a></li>
<li class="toctree-l3"><a class="reference internal" href="../modules_doc/module_metadata.html">Module Metadata</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tools.html">Tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tools/backup_restore.html">tools.backup_restore</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tools/build_requirements.html">tools.build_requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tools/conf_to_yaml_converter.html">tools.conf_to_yaml_converter</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../development_plugins.html">Development of Plugins</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../dev/README.html">Plugin development guidelines</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">How to write a Plugin in 5 min.</a></li>
<li class="toctree-l2"><a class="reference internal" href="smartplugin.html">Class SmartPlugin</a></li>
<li class="toctree-l2"><a class="reference internal" href="plugin_metadata.html">Plugin Metadata</a></li>
<li class="toctree-l2"><a class="reference internal" href="sampleplugins.html">Sample Plugins</a><ul>
<li class="toctree-l3"><a class="reference internal" href="sampleplugin.html">Sample Plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="sampleplugin_webif.html">Sample Plugin with web interface</a></li>
<li class="toctree-l3"><a class="reference internal" href="sampleplugin_1_1.html">Sample Plugin (old v1.1)</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../modules_doc/modules_plugins.html">Modules for use with plugins</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../modules_doc/module_dummy.html">Module dummy</a></li>
<li class="toctree-l3"><a class="reference internal" href="../modules_doc/module_http.html">Module http</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../modules_doc/modules_readmes.html">READMEs for Modules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../modules/dummy/README.html">Module dummy</a></li>
<li class="toctree-l3"><a class="reference internal" href="../modules/http/README.html">Module http</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="libraries_plugins.html">Libraries for use in plugins</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../lib/connection.html">lib.connection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lib/db.html">lib.db</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lib/logutils.html">lib.logutils</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lib/network.html">lib.network</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lib/orb.html">lib.orb</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lib/scheduler.html">lib.scheduler</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lib/tools.html">lib.tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lib/utils.html">lib.utils</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plugins/visu_smartvisu/README_for_developers.html">Visualisation plugin (smartVISU support) - for developers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugins/visu_websocket/README_for_visu_developers.html">Visualisation plugin (Websocket Protocol) - for developers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../development_core.html">Development - Core</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../core.html">Core of SmartHomeNG</a></li>
<li class="toctree-l2"><a class="reference internal" href="../core_libraries.html">Libraries</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../lib/config.html">lib.config</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lib/constants.html">lib.constants</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lib/daemon.html">lib.daemon</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lib/item.html">lib.item</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lib/item_conversion.html">lib.item_conversion</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lib/log.html">lib.log</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lib/logic.html">lib.logic</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lib/metadata.html">lib.metadata</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lib/module.html">lib.module</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lib/plugin.html">lib.plugin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lib/scene.html">lib.scene</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lib/shyaml.html">lib.shyaml</a></li>
<li class="toctree-l3"><a class="reference internal" href="../-----.html">&gt;———-&lt;</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lib/connection.html">lib.connection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lib/db.html">lib.db</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lib/logutils.html">lib.logutils</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lib/network.html">lib.network</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lib/orb.html">lib.orb</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lib/scheduler.html">lib.scheduler</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lib/tools.html">lib.tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="../lib/utils.html">lib.utils</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../core_modules.html">Core modules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../modules_doc/modules_readmes.html">READMEs for Modules</a></li>
<li class="toctree-l3"><a class="reference internal" href="../modules_doc/module_metadata.html">Module Metadata</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../release.html">Release Notes</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../release/1_3.html">Release 1.3 - August 5th, 2017</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release/1_2.html">Release 1.2 - May 16th, 2016</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release/1_1.html">Release 1.1 - April 13th, 2016</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release/1_0.html">Release 1.0 - November 14th, 2013</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release/0_9.html">Release 0.9 - June 6th 2013</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release/0_8.html">Release 0.8 - January 31st, 2013</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release/0_7.html">Release 0.7 - September 27th 2012</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release/0_6.html">Release 0.6 - June 21th, 2012</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release/0_5.html">Release 0.5 - July 12th, 2012</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release/0_4.html">Release 0.4 - October 10th, 2011</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release/0_3.html">Release 0.3 - August 14th, 2011</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release/0_2.html">Release 0.2 - June 21st, 2011</a></li>
<li class="toctree-l2"><a class="reference internal" href="../release/0_1.html">Release 0.1 - April 09th, 2011</a></li>
</ul>
</li>
</ul>

            
          
    <a href="genindex.html">Index</a>
  
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Developer Documentation</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../development_plugins.html">Development of Plugins</a> &raquo;</li>
        
      <li>How to write a Plugin in 5 min.</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/development_plugin/plugin_in5minutes.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="how-to-write-a-plugin-in-5-min">
<span id="how-to-write-a-plugin-in-5-min"></span><h1>How to write a Plugin in 5 min.</h1>
<p>Plugins are additions to the SmartHomeNG code that enable additional functions. Plugins are written in Python. To add a plugin you need the plugin code itself and an additional entry in the plugin.conf file.
A good basis for your own plugin is found in <code class="docutils literal"><span class="pre">dev/sample_plugin/__init__.py</span></code></p>
<div class="section" id="plugin-description">
<span id="plugin-description"></span><h2>Plugin description</h2>
<div class="section" id="overview">
<span id="overview"></span><h3>Overview</h3>
<p>The plugin is placed in it's own folder within the plugins folder. The name of the folder ist the name of the plugin and has to be <strong>all lowercase</strong>.</p>
<p>At the moment, the Plugin is made up of a minium of three files, which are located within that folder.</p>
<p>Those files are:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">__init__.py</span></code></li>
<li><code class="docutils literal"><span class="pre">README.md</span></code></li>
<li><code class="docutils literal"><span class="pre">plugin.yaml</span></code></li>
</ul>
<p>The file <code class="docutils literal"><span class="pre">__init__.py</span></code> contains the Python code of the plugin. The code should be at least Python 3.4 comatible.</p>
<p>The file <code class="docutils literal"><span class="pre">README.md</span></code> contains the basic documentation (in english language) of the plugin.</p>
<p>The file <code class="docutils literal"><span class="pre">plugin.yaml</span></code> contains metadata for the plugin. It is used to build the documentation. In the future, additional entries will be used by a graphical configuration frontend.</p>
<p>To get thee plugin loaded, it has to be configured in the configuration file etc/plugin.yaml (or etc/plugin.conf for older installations).</p>
<div class="section" id="the-readme-md-file">
<span id="the-readme-md-file"></span><h4>The <code class="docutils literal"><span class="pre">README.md</span></code> file</h4>
<p>The README.md file should have the following structure.</p>
<p>Make sure, that the first heading with the pluginname is the only first level heading (with one #) in the file.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span># &lt;pluginname&gt;

## Description

    Describe what the plugin does (what is it good for?)
    
## Support

    If a supportforum or thread exist, describe it and add a link to it in this section

## Version / Change History

    If you want, enter the change history here

## Requirements

    What other software or what hardware ist needed to use the plugin
    
## Configuration

### plugin.conf (deprecated) / plugin.yaml

#### Parameters

#### Example plugin configuration

### items.conf (deprecated) / items.yaml

#### Attributes

#### Example item configuration

### logic.conf (deprecated) / logic.yaml

## Functions
</pre></div>
</div>
</div>
<div class="section" id="the-metadata-file-plugin-yaml">
<span id="the-metadata-file-plugin-yaml"></span><h4>The metadata file <code class="docutils literal"><span class="pre">plugin.yaml</span></code></h4>
<p>The file containing metadata of the plugin has the following sections:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">plugin</span></code>  -  global attributes of the plugin</li>
<li><code class="docutils literal"><span class="pre">plugin_parameters</span></code>  - definition of the parameters used in <code class="docutils literal"><span class="pre">etc/plugin.yaml</span></code></li>
<li><code class="docutils literal"><span class="pre">item_attributes</span></code>  -  definition of the item-attributes that are defined by this plugin</li>
</ul>
<p>At the moment only one definition is required. It is the type of the plugin. The type of the plugin can be one of the following:</p>
<ul class="simple">
<li>gateway</li>
<li>interface</li>
<li>protocol</li>
<li>system</li>
<li>web</li>
</ul>
<p>Example of a metadate file:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="c1"># Metadata for the plugin</span>
<span class="l l-Scalar l-Scalar-Plain">plugin</span><span class="p p-Indicator">:</span>
    <span class="c1"># Global plugin attributes</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">interface</span>                <span class="c1"># plugin type (gateway, interface, protocol, system, web)</span>

<span class="l l-Scalar l-Scalar-Plain">plugin_parameters</span><span class="p p-Indicator">:</span>
    <span class="c1"># Definition of parameters to be configured in etc/plugin.yaml</span>
    
<span class="l l-Scalar l-Scalar-Plain">item_attributes</span><span class="p p-Indicator">:</span>
    <span class="c1"># Definition of item attributes defined by this plugin</span>
    
</pre></div>
</div>
</div>
</div>
<div class="section" id="configuring-the-plugin-in-the-configuration-file-etc-plugin-yaml">
<span id="configuring-the-plugin-in-the-configuration-file-etc-plugin-yaml"></span><h3>Configuring the plugin in the configuration file <code class="docutils literal"><span class="pre">etc/plugin.yaml</span></code></h3>
<p>The file plugin.yaml (or plugin.conf) is located in the subdirectory <code class="docutils literal"><span class="pre">etc</span></code> of SmartHomeNG base directory. It tells SmartHomeNG which plugins to load and where to find them. The following box is a typical entry for your new plugin in that file (old configuration file format.</p>
<p>Let's assume you are writing a new plugin named <strong>myplugin</strong>.</p>
<p>In the new configuration file format (yaml) the entry looks like this:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span>    <span class="c1"># etc/plugin.yaml</span>
    <span class="l l-Scalar l-Scalar-Plain">myplugin_instance</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">class_name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Myplugin</span>
        <span class="l l-Scalar l-Scalar-Plain">class_path</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">plugins.myplugin</span>
        <span class="l l-Scalar l-Scalar-Plain">Parameter1</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">42</span>
</pre></div>
</div>
<p>In the old configuration file format (conf) the entry looks like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>    <span class="c1"># etc/plugin.conf</span>
    <span class="p">[</span><span class="n">myplugin_instance</span><span class="p">]</span>
        <span class="n">class_name</span> <span class="o">=</span> <span class="n">Myplugin</span>
        <span class="n">class_path</span> <span class="o">=</span> <span class="n">plugins</span><span class="o">.</span><span class="n">myplugin</span>
        <span class="n">Parameter1</span> <span class="o">=</span> <span class="mi">42</span>
</pre></div>
</div>
<p>Let's look at the parameters:</p>
<p><code class="docutils literal"><span class="pre">myplugin_instance:</span></code> or <code class="docutils literal"><span class="pre">[myplugin_instance]</span></code></p>
<p>This is the name you give to actual loaded instace of the plugin. You can choose whatever you like. This is the name of the plugin instance when running SmartHomeNG. If you are running multiple instances of the plugin: This name you distinguishes the instances.</p>
<p><code class="docutils literal"><span class="pre">class_name:</span></code> or <code class="docutils literal"><span class="pre">class_name</span></code></p>
<p>The Parameter class_name is of course the class name you give to the new python class in the plugin. It has to match the class name in your python code as described in the following section. It is case-sensitive.</p>
<p><code class="docutils literal"><span class="pre">class_path:</span></code> or <code class="docutils literal"><span class="pre">class_path</span></code></p>
<p>The class_path parameter tells SmartHomeNG where to find the python code of the plugin. The example in the box means that your code is in the file <code class="docutils literal"><span class="pre">plugins/myplugin/__init__.py</span></code> where <code class="docutils literal"><span class="pre">plugins</span></code> is a subdirectory of SmartHomeNG base folder and <code class="docutils literal"><span class="pre">myplugin</span></code> is the folder where all files of the plugin reside. It is also the name of the plugin. The name of the folder has to be lower case.</p>
<p><code class="docutils literal"><span class="pre">Parameter1</span></code></p>
<p>You can add several parameters to the init file that are passed to your plugin during initialization. You can use them to set it up in a proper way.</p>
</div>
<div class="section" id="the-file-plugins-myplugin-init-py">
<span id="the-file-plugins-myplugin-init-py"></span><h3>The file plugins/myplugin/<strong>init</strong>.py:</h3>
<p>The next thing you need is the plugin itself. The main code is in the file …/plugins/myplugin/<strong>init</strong>.py. All plugins have the same structure. There are several functions that need to exist which are called by SmartHomeNG at certain events. For ease of use you can find an empty plugin at <code class="docutils literal"><span class="pre">dev/sample_plugin/__init__.py</span></code>.</p>
<p>The name of the directory where the plugin files reside <strong>in has to be in lower case</strong>!</p>
<p>In addition you need to write your own functions for the plugin. Normally those functions are executed by the sharthome.py scheduler. You can program the scheduler to call your functions at specified times or cycles. See chapter “The Scheduler” for more information.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">lib.model.smartplugin</span> <span class="kn">import</span> <span class="n">SmartPlugin</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Myplugin</span><span class="p">(</span><span class="n">SmartPlugin</span><span class="p">):</span>

<span class="n">ALLOW_MULTIINSTANCE</span> <span class="o">=</span> <span class="bp">False</span>
<span class="n">PLUGIN_VERSION</span> <span class="o">=</span> <span class="s2">&quot;a.b.c&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sh</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initalizes the plugin. The parameters describe for this method are pulled from the entry in plugin.conf.</span>

<span class="sd">        :param sh:  The instance of the smarthome object, save it for later references</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># attention:</span>
        <span class="c1"># if your plugin runs standalone, sh will likely be None so do not rely on it later or check it within your code</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_sh</span> <span class="o">=</span> <span class="n">sh</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>   <span class="c1"># get a unique logger for the plugin and provide it internally</span>

        <span class="c1"># todo:</span>
        <span class="c1"># put any initialization for your plugin here</span>


    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run method for the plugin</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;run method called&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alive</span> <span class="o">=</span> <span class="bp">True</span>


    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Stop method for the plugin</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;stop method called&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alive</span> <span class="o">=</span> <span class="bp">False</span>


    <span class="k">def</span> <span class="nf">parse_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Default plugin parse_item method. Is called when the plugin is initialized.</span>
<span class="sd">        The plugin can, corresponding to its attribute keywords, decide what to do with</span>
<span class="sd">        the item in future, like adding it to an internal array for future reference</span>

<span class="sd">        :param item:    The item to process.</span>
<span class="sd">        :return:        If the plugin needs to be informed of an items change you should return a call back function</span>
<span class="sd">                        like the function update_item down below. An example when this is needed is the knx plugin</span>
<span class="sd">                        where parse_item returns the update_item function when the attribute knx_send is found.</span>
<span class="sd">                        This means that when the items value is about to be updated, the call back function is called</span>
<span class="sd">                        with the item, caller, source and dest as arguments and in case of the knx plugin the value</span>
<span class="sd">                        can be sent to the knx with a knx write function within the knx plugin.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_iattr</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">conf</span><span class="p">,</span> <span class="s1">&#39;foo_itemtag&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;parse item: {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>

        <span class="c1"># todo</span>
        <span class="c1"># if interesting item for sending values:</span>
        <span class="c1">#   return update_item</span>


    <span class="k">def</span> <span class="nf">parse_logic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logic</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Default plugin parse_logic method</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;xxx&#39;</span> <span class="ow">in</span> <span class="n">logic</span><span class="o">.</span><span class="n">conf</span><span class="p">:</span>
            <span class="c1"># self.function(logic[&#39;name&#39;])</span>
            <span class="k">pass</span>


    <span class="k">def</span> <span class="nf">update_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">caller</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write items values</span>

<span class="sd">        :param item: item to be updated towards the plugin</span>
<span class="sd">        :param caller: if given it represents the callers name</span>
<span class="sd">        :param source: if given it represents the source</span>
<span class="sd">        :param dest: if given it represents the dest</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># todo </span>
        <span class="c1"># change &#39;foo_itemtag&#39; into your attribute name</span>
        <span class="k">if</span> <span class="n">item</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_iattr</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">conf</span><span class="p">,</span> <span class="s1">&#39;foo_itemtag&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="p">(</span><span class="s2">&quot;update_item ws called with item &#39;{}&#39; from caller &#39;{}&#39;, source &#39;{}&#39; and dest &#39;{}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">caller</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">dest</span><span class="p">))</span>
                <span class="k">pass</span>


<span class="k">def</span> <span class="nf">run_logic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logic</span><span class="p">,</span> <span class="n">caller</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="c1"># …</span>

<span class="k">def</span> <span class="nf">bla</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;bla&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>First you import certain things you need and get acess to the logger. The logger allows you to log output of your plugin into the smarthome.log file. Then you start you class. The classname has to match the classname parameter in the plugin.conf file. Afterwards you define the required functions.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">smarthome</span><span class="p">,</span> <span class="n">Parameter1</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
</pre></div>
</div>
<p>The function <strong>init</strong> is called once when SmartHomeNG initializes before the items are loaded. Here you place the code that is needed to initialize you plugin. For example you can open a serial port if you need to communicate to an external device, open files, initialize other variables you need and so on.
The function receives the parameter “smarthome” which gives access to the SmartHomeNG functions. You should save the value in a variable for later use like in the example above.
Other parameter values are received from the file plugin.conf. You can default values for the case that the parameter is not defined in the plugin.conf file. It is a good practice to log your plugin name to the smarthome.log file.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</pre></div>
</div>
<p>The function run is called once when SmartHomeNG starts. Run is executed after all items are loaded. You need to set the variable self.alive=True here.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</pre></div>
</div>
<p>This is called when SmartHomeNG shuts down. This is the right place to close files and data connections. You need to set the variable self.alive=False here.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">parse_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
</pre></div>
</div>
<p>This function is called for each item during startup when SmartHomeNG reads the item.conf file. You can access item parameters and start according action here. For example you have the following item defined in …/items/xxx.conf</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>    # items/xxx.conf
    [upstairs]
        [[lamp]]
            type = bool
            visu_acl = rw
            ivalue = 1
            knx_dpt = 1
            …
</pre></div>
</div>
<p>Using the new configuration file format the configuration looks like this:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span>    <span class="c1"># items/xxx.yaml</span>
    <span class="l l-Scalar l-Scalar-Plain">upstairs</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">lamp</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">bool</span>
            <span class="l l-Scalar l-Scalar-Plain">visu_acl</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">rw</span>
            <span class="l l-Scalar l-Scalar-Plain">ivalue</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
            <span class="l l-Scalar l-Scalar-Plain">knx_dpt</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
            <span class="l l-Scalar l-Scalar-Plain">…</span>
</pre></div>
</div>
<p>You can access the parameter ivalue using the following code:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>    <span class="k">if</span> <span class="s1">&#39;ivalue&#39;</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">conf</span><span class="p">:</span>
        <span class="n">ad</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">conf</span><span class="p">[</span><span class="s1">&#39;ivalue&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_item</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
</pre></div>
</div>
<p>Here you check if the parameter ivalue is defined in the item. It case it is, the variable ad is set to the parameter value and the function update_item is returned. The function update_item is called each time when the item changes. Each time the lamp is switched on or off by KNX or something else, the function update_item is called.
The paramter values are always string values. Even if you set ivalue=1 in the plugin.conv your code
will receive the string '1'. If you need a number you must convert it on your own.
If the parameter ivalue is not in the item definition, nothing is done and a change of the item does not affect you plugin at all.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">parse_logic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logic</span><span class="p">):</span>    <span class="c1"># (version&gt;=1.3)</span>
</pre></div>
</div>
<p>This function called for each logic during startup when SmartHomeNG reads the logic.conf file. You can access logic parameters and start according action here. For example you have the following logic defined in …/etc/logic.conf</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>    <span class="n">etc</span><span class="o">/</span><span class="n">logic</span><span class="o">.</span><span class="n">conf</span>
    <span class="p">[</span><span class="n">jalousie_up</span><span class="p">]</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">jalousie</span><span class="o">-</span><span class="n">up</span><span class="o">.</span><span class="n">py</span>
        <span class="n">crontab</span> <span class="o">=</span> <span class="n">sunrise</span><span class="o">+</span><span class="mi">20</span><span class="n">m</span>
        <span class="n">some_plugin_setting</span> <span class="o">=</span> <span class="n">send</span><span class="o">-</span><span class="n">notify</span>
</pre></div>
</div>
<p>Using the new configuration fiel format, the configuration looks like this:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span>    <span class="l l-Scalar l-Scalar-Plain">etc/logic.yaml</span>
    <span class="l l-Scalar l-Scalar-Plain">jalousie_up</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">filename</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">jalousie-up.py</span>
        <span class="l l-Scalar l-Scalar-Plain">crontab</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">sunrise+20m</span>
        <span class="l l-Scalar l-Scalar-Plain">some_plugin_setting</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">send-notify</span>
</pre></div>
</div>
<p>A plugin can now check the <code class="docutils literal"><span class="pre">some_plugin_setting</span></code> to find logics where the execution is interesting for it. The following implementation could be used to register a hook for such logics:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>    <span class="k">if</span> <span class="s1">&#39;some_plugin_setting&#39;</span> <span class="ow">in</span> <span class="n">logic</span><span class="o">.</span><span class="n">conf</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_logic</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">update_item</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">caller</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
</pre></div>
</div>
<p>This function is called each time an item changes. It receives several parameters:</p>
<p><code class="docutils literal"><span class="pre">caller</span></code></p>
<p>This is a string that identifies the one who changed the item. It’s value is e.g. KNX if the item has been changed by the KNX plugin.</p>
<p><code class="docutils literal"><span class="pre">source</span></code></p>
<p>…</p>
<p><code class="docutils literal"><span class="pre">dest</span></code></p>
<p>…</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">run_logic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logic</span><span class="p">,</span> <span class="n">caller</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>    <span class="c1"># (version&gt;=1.3)</span>
</pre></div>
</div>
<p>This is like the <code class="docutils literal"><span class="pre">update_item()</span></code> method except that it is called on logic execution.</p>
<p>Besides those pre-defined functions you can define additional functions that are needed for your plugin.</p>
</div>
</div>
<div class="section" id="smarthomeng-functions">
<span id="smarthomeng-functions"></span><h2>SmartHomeNG functions</h2>
<div class="section" id="the-scheduler">
<span id="the-scheduler"></span><h3>The Scheduler</h3>
<p>The scheduler is one of the most important functions of SmartHomeNG It is the main time machine that starts functions at specified times. In order for your own functions to be executed you need to propagate them to the scheduler. You do this by calling certain scheduler functions. The scheduler is part of SmartHomeNG, so you need to access it using the variable you defined in the <strong>init</strong> function. The most important function is add:</p>
<div class="section" id="add">
<span id="add"></span><h4>Add</h4>
<div class="highlight-python"><div class="highlight"><pre><span></span>    <span class="bp">self</span><span class="o">.</span><span class="n">_sh</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span>
                           <span class="n">obj</span><span class="p">,</span>
                           <span class="n">prio</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                           <span class="n">cron</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                           <span class="n">cycle</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                           <span class="n">value</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                           <span class="n">offset</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                           <span class="nb">next</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
</pre></div>
</div>
<p>scheduler.add adds an entry to the scheduler. You need to call it with at least three parameters, the name, object and one timing parameter.</p>
<p><code class="docutils literal"><span class="pre">name=string</span></code></p>
<p>This is a string value which is the name you give to the scheduler entry. You need the name in case you want to remove the entry from the scheduler.</p>
<p><code class="docutils literal"><span class="pre">obj=function</span></code></p>
<p>Obj is a function that has been defined in your plugin. This function will be called by the scheduler. If you want to pass arguments to the function use **kwargs (see description of parameter value below).</p>
<p><code class="docutils literal"><span class="pre">cron</span></code></p>
<p>…</p>
<p><code class="docutils literal"><span class="pre">cycle=int</span></code></p>
<p>Cycle is an integer value of seconds. It tells the scheduler to call your function defined by obj regularly. If you set cycles to 60 your function will be called each 60 seconds as long as long as SmartHomeNG is up.</p>
<p><code class="docutils literal"><span class="pre">value</span></code></p>
<p>The parameter value allows you to pass parameters to the function that is called be the scheduler. You can use a keyworded variable list of parameters. Define you function in the following way:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>    <span class="n">_bla</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;heinz&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;found&quot;</span><span class="p">)</span>
            <span class="n">em</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;heinz&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>In that case you should call the scheduler with a value list:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>    <span class="bp">self</span><span class="o">.</span><span class="n">_sh</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">_bla</span><span class="p">,</span>
                           <span class="n">value</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;heinz&#39;</span><span class="p">:</span> <span class="n">bla</span><span class="p">,</span> <span class="s1">&#39;tom&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span>
                           <span class="nb">next</span><span class="o">=</span><span class="n">_ndate</span><span class="p">)</span>
</pre></div>
</div>
<blockquote>
<div><strong>Warning</strong>: Passing values via the scheduler only works when the scheduler is called with one single trigger time using the “next” parameter. When the scheduler is called with cycle, no parameters are passed to the called function.</div></blockquote>
<p><code class="docutils literal"><span class="pre">offset=int</span></code></p>
<p>Offset is a value in seconds that works together with cycle. It defines the delay of the first trigger after the plugin is initialized. For example: You set offset to 20 and cycle to 10. The scheduler will trigger the first time 20 seconds after initialization and then each 10 seconds. If you do not define offset or set it to none, SmartHomeNG will choose a random value between 10 and 15 seconds.</p>
<p><code class="docutils literal"><span class="pre">next=dateobject</span></code></p>
<p>Next is a time object that tells the scheduler to trigger once at a specified time. It is a date object that you create e.g. using datetime like here:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>    <span class="n">nd</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="s1">&#39;Jan 14 2015 8:09PM&#39;</span><span class="p">,</span><span class="s1">&#39;%b </span><span class="si">%d</span><span class="s1"> %Y %I:%M%p&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">tzinfo</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sh</span><span class="o">.</span><span class="n">tzinfo</span><span class="p">())</span>
</pre></div>
</div>
<p>Important: It is important to include the time zone info in the object. Otherwise the scheduler will crash. Here we use the time zone info from SmartHomeNG.</p>
</div>
<div class="section" id="remove">
<span id="remove"></span><h4>Remove</h4>
<div class="highlight-python"><div class="highlight"><pre><span></span>    <span class="bp">self</span><span class="o">.</span><span class="n">_sh</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
<p>The function remove removes an entry from the scheduler.</p>
<p><code class="docutils literal"><span class="pre">Name=string</span></code></p>
<p>Name is a string value with the name of the entry.</p>
</div>
</div>
</div>
<div class="section" id="finding-items">
<span id="finding-items"></span><h2>Finding Items</h2>
<div class="highlight-python"><div class="highlight"><pre><span></span>    <span class="n">sh</span><span class="o">.</span><span class="n">return_item</span><span class="p">(</span><span class="n">item_path</span><span class="p">)</span>
</pre></div>
</div>
<p>Return_item allows you to find an item by its name.</p>
<p><code class="docutils literal"><span class="pre">item_path=string</span></code></p>
<p>The path of the item as defined in the items configuration file e.g. Floor1.Room1.Lamp1.
The function returns the item object which can be called to modify the value or access other
properties.</p>
<div class="section" id="modifiy-items">
<span id="modifiy-items"></span><h3>Modifiy Items</h3>
<p>An item can be modified by calling it like a function.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">item</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">caller</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">value</span></code></p>
<p>The value that the item is set to. For a binary item is it True or False.</p>
<p><code class="docutils literal"><span class="pre">caller=string</span></code></p>
<p>A name you choose the names the one who made the change to the item. This is passed caller argument of the function update_item.</p>
</div>
</div>
<div class="section" id="summary">
<span id="summary"></span><h2>Summary</h2>
<p><img alt="Summary" src="https://github.com/smarthomeNG/smarthome/wiki/assets/pluginsummary.png" /></p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="smartplugin.html" class="btn btn-neutral float-right" title="Class SmartPlugin" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../dev/README.html" class="btn btn-neutral" title="Plugin development guidelines" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016-2017 SmartHomeNG Team, based on smarthome.py © 2011-2014 Marcus Popp.

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.3c develop (as of 31. October 2017, commit 34c17bf)',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>