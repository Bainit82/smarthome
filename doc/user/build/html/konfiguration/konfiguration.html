

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Konfiguration &mdash; Anwenderdokumentation 1.3c develop (as of 1. November 2017, commit 34c17bf) Dokumentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
        <link rel="index" title="Stichwortverzeichnis"
              href="../genindex.html"/>
        <link rel="search" title="Suche" href="../search.html"/>
    <link rel="top" title="Anwenderdokumentation 1.3c develop (as of 1. November 2017, commit 34c17bf) Dokumentation" href="../index.html"/>
        <link rel="next" title="Konfigurationsdateien" href="konfigurationsdateien.html"/>
        <link rel="prev" title="Update von einer älteren Version" href="../installation/update_upgrade.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Anwenderdokumentation
          

          
            
            <img src="../_static/logo_long_inverse3.png" class="logo" />
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
    
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../einleitung.html">Einleitung</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation/installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../installation/anforderungen.html">Hard- u. Software Anforderungen</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation/komplettanleitung.html">Komplettanleitung</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation/docker.html">Installation über Docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation/update_upgrade.html">Update von einer älteren Version</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Konfiguration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="konfigurationsdateien.html">Konfigurationsdateien</a></li>
<li class="toctree-l2"><a class="reference internal" href="itemkonfiguration.html">Initiale Item Konfiguration</a></li>
<li class="toctree-l2"><a class="reference internal" href="items.html">Items</a><ul>
<li class="toctree-l3"><a class="reference internal" href="items_systemitems.html">Systemitems</a></li>
<li class="toctree-l3"><a class="reference internal" href="items_astronomie.html">Beispiele: Astronomie</a></li>
<li class="toctree-l3"><a class="reference internal" href="items_tipps.html">Tipps &amp; Tricks</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="plugins.html">Plugins</a></li>
<li class="toctree-l2"><a class="reference internal" href="logiken.html">Logiken</a></li>
<li class="toctree-l2"><a class="reference internal" href="logging.html">Logging</a><ul>
<li class="toctree-l3"><a class="reference internal" href="logging_best_practices.html">Logging - Best Practices</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../visualisierung/visualisierung.html">Visualisierung mit smartVISU</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../visualisierung/reverse_proxy.html">NGINX als ReverseProxy</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../backend/backend.html">Administrations GUI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../fehlersuche.html">Fehlersuche</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ - Häufig gestellte Fragen</a></li>
<li class="toctree-l1"><a class="reference internal" href="../entwickler_doku.html">Entwickler Dokumentation (Englisch)</a></li>
</ul>

            
          
    <a href="genindex.html">Stichwort-Verzeichnis</a>
  
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Anwenderdokumentation</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Konfiguration</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/konfiguration/konfiguration.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="konfiguration">
<h1>Konfiguration</h1>
<div class="toctree-wrapper compound">
</div>
<div class="section" id="uberblick">
<h2>Überblick</h2>
<p>Die Codebasis von SmartHomeNG ist in der Programmiersprache Python geschrieben. Python ist</p>
<ul class="simple">
<li>kostenlos</li>
<li>einfach zu erlernen</li>
<li>elegant in der Anwendung</li>
<li>objektorientiert</li>
<li>Open-Source-Software</li>
<li>plattformunabhängig</li>
</ul>
<p>(allerdings werden derzeit bei SmartHomeNG Linux-Besonderheiten genutzt so dass z.B. Windows derzeit nicht genutzt werden kann)
* multi-threaded</p>
<p>Wichtig für den Einsteiger ist es zu wissen, dass Python peinlich genau auf Einrückungen achtet. Etwas wie</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>def foo(a):
   bar = a
   d = 5
   x = a
   s = &#39;text&#39;
</pre></div>
</div>
<p>führt unweigerlich zu Fehlern. Auch ist ein Mischen von TAB und Leerzeichen oftmals eine Fehlerquelle. Um diese Quellen von Ärgernissen auszuschalten, macht es Sinn einen Editor zu verwenden, den man von vorne herein auf <strong>UTF-8 ohne BOM</strong> und umwandeln von <strong>TAB in 4 Leerzeichen</strong> einstellen kann.</p>
<p>Passende Editoren sind z.B.</p>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Plattform</th>
<th class="head">Editor</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Linux</td>
<td>emacs (nano oder vi ginge zur Not auch)</td>
</tr>
<tr class="row-odd"><td>Windows</td>
<td>[Notepad++](www.notepad-plus-plus.org)</td>
</tr>
<tr class="row-even"><td>Mac</td>
<td>TextWrangler oder BBEdit</td>
</tr>
</tbody>
</table>
<p>Ein guter Editor unterstützt dann auch mit der richtigen Syntaxeinfärbung.</p>
<div class="highlight-Python"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
   <span class="n">bar</span> <span class="o">=</span> <span class="n">a</span>
   <span class="n">d</span> <span class="o">=</span> <span class="mi">5</span>
   <span class="n">x</span> <span class="o">=</span> <span class="n">a</span>
   <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;text&#39;</span>
</pre></div>
</div>
<p>Gute Einführungen zu Python sind <a class="reference external" href="https://github.com/smarthomeNG/smarthome/wiki/Python">hier</a> zu finden.</p>
<div class="section" id="verzeichnisse-in-smarthomeng">
<h3>Verzeichnisse in SmartHomeNG</h3>
<p>Die Verzeichnisse sind im Hauptverzeichnis von smarthome zu finden, für gewöhnlich im Ordner <strong>„/usr/local/smarthome/“</strong>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="8%" />
<col width="92%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Verzeichnis</th>
<th class="head">Beschreibung / Inhalt</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>bin</td>
<td>Hauptmodul von SmarthomeNG</td>
</tr>
<tr class="row-odd"><td>dev</td>
<td>Grundgerüst und Infos zur Pluginentwicklung</td>
</tr>
<tr class="row-even"><td>doc</td>
<td>Wird einmal die Dokumentation enthalten</td>
</tr>
<tr class="row-odd"><td>etc</td>
<td>enthält mindestens <strong>smarthome.conf</strong>, <strong>plugin.conf</strong> und <strong>logic.conf</strong>. In diesen Dateien befindet sich die Konfiguration des Grundsystems</td>
</tr>
<tr class="row-even"><td>examples</td>
<td>Beispiele für Items</td>
</tr>
<tr class="row-odd"><td>items</td>
<td>Items</td>
</tr>
<tr class="row-even"><td>lib</td>
<td>Modulbibliothek für das Hauptprogramm</td>
</tr>
<tr class="row-odd"><td>logics</td>
<td>Jede Logik bekommt hier eine kleine Datei mit Python Code</td>
</tr>
<tr class="row-even"><td>plugins</td>
<td>Modulbibliothek für die Plugins. Jedes Plugin hat sein eigenes Unterverzeichnis</td>
</tr>
<tr class="row-odd"><td>scenes</td>
<td>Gespeicherte Szenen</td>
</tr>
<tr class="row-even"><td>tests</td>
<td>Hilfsprogramme zum Testen von Modulen des Systems</td>
</tr>
<tr class="row-odd"><td>tools</td>
<td>Hilfsprogramme</td>
</tr>
<tr class="row-even"><td>var</td>
<td>Daten die vom SmartHomeNG zur Laufzeit gespeichert und gelesen werden  also z.B. Logdateien, cache, sqlite Datenbank, etc.</td>
</tr>
</tbody>
</table>
<div class="section" id="dateien-in-etc">
<h4>Dateien in etc</h4>
<p>Während der Installation sind im Unterverzeichnis <strong>etc</strong> bereits drei Dateien erstellt worden: <strong>smarthome.conf</strong>, <strong>plugin.conf</strong> und <strong>logic.conf</strong>.</p>
<div class="section" id="smarthome-conf">
<h5>smarthome.conf</h5>
<p>In der <strong>smarthome.conf</strong> wird notiert, wo sich die Installation befindet und welche Zeitzone als Basis genommen werden soll:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span># smarthome.conf / smarthome.ymal
lat = 50.123
lon = 14.67
elev = 36
tz = &#39;Europe/Berlin&#39;

# Version 1.3
# module_paths = /usr/local/python/lib    # Format: /path/one | /path/two

# Version 1.3: control type casting when assiging values to items
#assign_compatibility = latest            # latest or compat_1.2 (compat_1.2 is default for shNG v1.3)
</pre></div>
</div>
<p>Die gleiche Konfiguration im neuen Dateiformat für Konfigurationsdateien:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="c1"># smarthome.yaml</span>
<span class="l l-Scalar l-Scalar-Plain">lat</span><span class="p p-Indicator">:</span> <span class="s">&#39;50.123&#39;</span>
<span class="l l-Scalar l-Scalar-Plain">lon</span><span class="p p-Indicator">:</span> <span class="s">&#39;14.67&#39;</span>
<span class="l l-Scalar l-Scalar-Plain">elev</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">36</span>
<span class="l l-Scalar l-Scalar-Plain">tz</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Europe/Berlin</span>

<span class="c1"># Version 1.3</span>
<span class="c1"># module_paths = /usr/local/python/lib    # list of path-entries is possible</span>

<span class="c1"># Version 1.3: control type casting when assiging values to items</span>
<span class="c1"># assign_compatibility = latest            # latest or compat_1.2 (compat_1.2 is default for shNG v1.3)</span>
</pre></div>
</div>
<p>Mit dieser Version können auch zusätzliche Modulpfade konfiguriert werden, in denen Drittanbieter-Bibliotheken abgelegt sind (<cite>module_paths</cite> Einstellung). Somit können Bibliotheken, beispielsweise in Logiken, verwendet werden die nicht direkt mit ausgeliefert bzw. installiert werden. Es kann ein oder mehrere absolute Pfade angegeben werden.</p>
<p>Außerdem kann der Datentyp einer Wertzuweisung bei der Nutzung von <cite>autotimer</cite> und <cite>cycle</cite> beeinflusst werden.
<a class="reference external" href="https://github.com/smarthomeNG/smarthome/wiki/Items#datentyp-der-wertzuweisung">Weiterführende Informationen</a>
dazu gibt es <a class="reference external" href="https://github.com/smarthomeNG/smarthome/wiki/Items#datentyp-der-wertzuweisung">hier</a>.</p>
</div>
<div class="section" id="plugin-conf">
<h5>plugin.conf</h5>
<p>Die <strong>plugin.conf</strong> enthält die Konfigurationsanweisungen für alle Plugins, die benutzt werden sollen.</p>
<div class="highlight-text"><div class="highlight"><pre><span></span># plugin.conf
[knx]
   class_name = KNX
   class_path = plugins.knx
   host = 127.0.0.1
   port = 6720
#   send_time = 600 # update date/time every 600 seconds, default none
#   time_ga = 1/1/1 # default none
#   date_ga = 1/1/2 # default none
[visu]
    class_name = WebSocket
    class_path = plugins.visu
    smartvisu_dir = /var/www/html/smartVISU
[cli]
    class_name = CLI
    class_path = plugins.cli
    ip = 0.0.0.0
    update = True
[sql]
    class_name = SQL
    class_path = plugins.sqlite
</pre></div>
</div>
<p>Seit Version 1.2 (Master Branch) gibt es ein neues Plugin für das Backend. Dabei kann man ber einen Browser das gleiche erreichen, wie früher über das CLI-Plugin. Das Backend bindet man dann ein über:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>[BackendServer]
    class_name = BackendServer
    class_path = plugins.backend
    updates_allowed = True
    user = admin
    password = xxxx
    language = de
    threads = 8
    #ip = 0.0.0.0
    #port = 8383
</pre></div>
</div>
<p>Für die weitere Einrichtung und Konfiguration von Plugins geht es <a class="reference external" href="plugins.html">hier</a> weiter.</p>
</div>
<div class="section" id="logic-conf">
<h5>logic.conf</h5>
<p>In der <strong>logic.conf</strong> werden die Logiken eingetragen. Der Name jeder Logik kommt zwischen zwei eckige Klammern, der Eintrag <strong>filename</strong> verweist auf die Python-Datei die dann aufgerufen wird, wenn die Logik abgearbeitet werden soll. <strong>crontab</strong> schreibt fest, dass die Logik zu bestimmten Zeiten ausgeführt werden soll. watch_item bestimmt, welche Items die Logik aufrufen können:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span># logic.conf
[InitSmarthomeNG]
    filename = InitSmartHomeNG.py
    crontab = init

[Beispiellogik]
    # Umgebungsvariablen des Systems werden aktualisiert, z.B. Diskusage
    filename = Beispiel.py
    watch_item = *:Logikaufruf | item1.* | parent.item2
    crontab = init | 0,5,10,15,20,25,30,35,40,45,50,55 * * * # run every 5 minutes
</pre></div>
</div>
<p>Detaillierte Infos zur crontab Konfiguration finden sich <a class="reference external" href="https://github.com/smarthomeNG/smarthome/wiki/Items#attribut-crontab">hier</a>.</p>
<p>Für die weitere Konfiguration von Logiken geht es <a class="reference external" href="logiken.html">hier</a> weiter.</p>
</div>
<div class="section" id="weitere-dateien">
<h5>Weitere Dateien</h5>
<p>Zusätzlich sind ab der Version 1.2 auch noch <strong>logging.yaml</strong>, <strong>plugin.conf.default</strong> und <strong>smarthome.conf.default</strong> zu finden.
Während sich der Inhalt der <strong>.default</strong> Dateien als Beispieldatei selbst erklärt, ist die <strong>logging.yaml</strong> noch erklärungsbedürftig:
Im gesamten Programmcode sind Anweisungen verteilt, die bestimmte Programmzustände loggen, also mitnotieren. Im einfachsten Fall sind das einfache Meldungen die z.B. den Start eines Plugins melden oder aber das setzen eines Items durch die Visu oder aber das Ausführen einer Datenbankkomprimierung. Es sind aber auch Meldungen dabei, die über Fehler berichten, z.B. wenn ein Item das über die Visu akualisiert werden soll, gar nicht existiert oder wenn zum Beispiel ein Plugin einen Fehler bei der Abfrage von Daten eines Stromzählers meldet.</p>
<p>Mit der <strong>logging.yaml</strong> kann man ziemlich fein steuern von welchen Modulen man welche Meldungen bekommen möchte. Sucht man beispielsweise einen hartnäckigen Fehler in einem neuen Plugin <strong>Foo</strong>, dann kann man das Logging für alle anderen Plugins gezielt reduzieren so das man sich aufs Wesentliche konzentrieren kann.</p>
<p>Weitere Informationen gibt es unter <a class="reference external" href="logging.html">Konfiguration - Logging</a></p>
</div>
</div>
<div class="section" id="dateien-in-items">
<h4>Dateien in items</h4>
<p>Hier finden sich die Dateien mit den Items. Es ist egal, wie viele Dateien hier abgelegt wurden. Alle Dateien die die Endung .conf besitzen, werden beim Start von SmartHomeNG gelesen und in die Struktur von SmartHomeNG eingebaut.
Eine genaue Beschreibung des Aufbaus findet sich <a class="reference external" href="Items-und-Eval">hier</a>.</p>
<p><strong>Aus Gründen der Übersichtlichkeit macht es durchaus Sinn, die .conf-Dateien nach Räumen oder nach thematischen Gesichtspunkten aufzusplitten und die jeweiligen Items dort zu parametrieren.</strong></p>
<p><strong>Beispielsweise:</strong>
* eg_kueche.conf
* eg_wohnzimmer.conf
* og_schlafzimmer_eltern.conf
* og_schlafzimmer_ryan.conf
* terrasse.conf
* kwl.conf
* zentralheizung.conf
* …</p>
<p><strong>Wichtig: Wenn eine Item-Datei oder eine Logic-Datei neu erstellt oder geändert worden ist oder ein neues Plugin implementiert werden soll, muss SmartHomeNG neu gestartet werden.</strong></p>
<p>Der Dienst kann über den entsprechenden Befehl „systemctl“ neu gestartet werden.
<code class="docutils literal"><span class="pre">`</span>
<span class="pre">sudo</span> <span class="pre">systemctl</span> <span class="pre">restart</span> <span class="pre">smarthome.service</span>
<span class="pre">`</span></code></p>
</div>
<div class="section" id="weiterfuhrende-themen">
<h4>Weiterführende Themen</h4>
<p>[[UZSU (Universelle Zeitschaltuhr)|UZSU-(Universelle-Zeitschaltuhr)]]</p>
</div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="konfigurationsdateien.html" class="btn btn-neutral float-right" title="Konfigurationsdateien" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../installation/update_upgrade.html" class="btn btn-neutral" title="Update von einer älteren Version" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016-2017 SmartHomeNG Team, based on smarthome.py © 2011-2014 Marcus Popp.

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.3c develop (as of 1. November 2017, commit 34c17bf)',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/translations.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>